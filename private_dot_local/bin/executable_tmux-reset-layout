#!/usr/bin/env bash

session=$(tmux display-message -p '#S')
dir=$(tmux display-message -p '#{session_path}')

# Capture existing window IDs
old_windows=$(tmux list-windows -t "$session" -F '#{window_id}')

# Create new windows and capture their IDs
nvim_id=$(tmux new-window -t "$session" -n nvim -c "$dir" -P -F '#{window_id}')
claude_id=$(tmux new-window -t "$session" -n claude -c "$dir" -P -F '#{window_id}')
tmux split-window -t "$claude_id" -h -c "$dir"
tmux new-window -t "$session" -n servers -c "$dir"

# Kill old windows by ID
for wid in $old_windows; do
    tmux kill-window -t "$wid" 2>/dev/null
done

# Now send nvim after old windows are gone
tmux send-keys -t "$nvim_id" "nvim" Enter
tmux select-window -t "$nvim_id"
